# Test del Chi-quadro

Il test del Chi-quadro è un insieme di test statistici utilizzati per verificare se i dati osservati seguono una determinata distribuzione teorica. Esistono diverse varianti, ognuna adatta a contesti specifici.

### Tipi di test del Chi-quadro

1. **Test elementare per distribuzioni discrete semplici**, ad esempio per verificare se un dado è truccato.
2. **Test su distribuzioni qualsiasi**, anche continue o con molti valori distinti.
3. **Test per famiglie di distribuzioni con parametri ignoti**, come la verifica della gaussianità.
4. **Test basato su tabelle di contingenza**, per controllare l’indipendenza tra due variabili categoriali.



### Test del Chi-quadro elementare

Si supponga di avere un campione $X_1, ..., X_n$ generato da una legge incognita $\varphi$, che può assumere $K$ valori distinti. Si vuole verificare se questa distribuzione coincide con una distribuzione teorica prefissata $\varphi_0$.

#### Ipotesi:

- $H_0: \varphi = \varphi_0$
- $H_1: \varphi \ne \varphi_0$

#### Esempio
Verificare se un dado è equo: $\varphi_0 = (1/6, 1/6, ..., 1/6)$.

Si calcolano le frequenze osservate:
$$
O_j = \#\{ i: X_i = j \} \quad \text{per } j = 1, ..., K
$$

e i valori attesi:
$$
A_j = n \cdot \varphi_0(j)
$$

#### Statistica di Pearson
La statistica che misura la discrepanza tra osservato e atteso è:
$$
W = \sum_{j=1}^K \frac{(O_j - A_j)^2}{A_j}
$$
Sotto l'ipotesi nulla e per campioni abbastanza grandi, $W$ segue approssimativamente una distribuzione $\chi^2$ con $K - 1$ gradi di libertà.

#### Statistica alternativa: G
Una variante più moderna utilizza la cosiddetta statistica G:
$$
G = 2 \sum_{j=1}^K O_j \log \frac{O_j}{A_j}
$$
Anche $G$ approssima una distribuzione $\chi^2(K - 1)$.

#### Condizioni di applicabilità
Affinché l'approssimazione sia valida, si richiede:
- $A_j \ge 1$ per tutti i $j$
- almeno l’80% degli $A_j$ sia maggiore di 5



### Estensione a distribuzioni con molti valori o continue

Quando la distribuzione da testare è continua (es. esponenziale, normale) o ha molti valori, si suddivide lo spazio in $K$ intervalli (detti "bin") e si contano le frequenze osservate nei bin.

Per ciascun bin $B_j$, si ha:
- $O_j = \# \{ X_i \in B_j \}$
- $A_j = n \cdot P_{H_0}(X \in B_j)$

**Suggerimento:** scegliere bin in modo che i $A_j$ siano più omogenei possibili (equiprobabili sotto $H_0$).



### Estensione a famiglie parametriche

A volte non si ha una distribuzione teorica fissata, ma si vuole verificare se i dati provengono da una certa famiglia (es. Normali) con parametri ignoti.

#### Esempio
Si vuole testare se $X \sim \mathcal{N}(\mu, \sigma^2)$, ma $\mu$ e $\sigma$ non sono noti. In tal caso:
- si stimano $\hat{\mu}$ e $\hat{\sigma}$ dal campione
- si calcola $W$ o $G$ sulla base della distribuzione $N(\hat{\mu}, \hat{\sigma}^2)$

**Nota importante:** si perdono gradi di libertà per ogni parametro stimato. Ad esempio, se si stimano 2 parametri, la statistica segue $\chi^2(K - 3)$.



### Test su tabelle di contingenza

Quando si vogliono confrontare due variabili categoriali (es. trattamento e guarigione), si costruisce una tabella che riporta le frequenze $O_{ij}$.

#### Ipotesi:
- $H_0$: le due variabili sono indipendenti
- $H_1$: le variabili sono associate

#### Valori attesi:
$$
A_{ij} = \frac{\text{Totale riga } i \cdot \text{Totale colonna } j}{N}
$$

#### Statistica di Pearson:
$$
W = \sum_{i=1}^m \sum_{j=1}^n \frac{(O_{ij} - A_{ij})^2}{A_{ij}} \sim \chi^2((m - 1)(n - 1))
$$

#### Statistica G:
$$
G = 2 \sum_{i,j} O_{ij} \log \frac{O_{ij}}{A_{ij}} \sim \chi^2((m - 1)(n - 1))
$$



### Versioni esatte del test

Quando le frequenze attese sono troppo piccole, la distribuzione $\chi^2$ non è più un'approssimazione affidabile. In questi casi si usano:

#### Simulazione Monte Carlo:
- si generano molteplici campioni sotto $H_0$ e si costruisce la distribuzione empirica di $W$.

#### Enumerazione esaustiva:
- si calcolano esattamente tutte le possibili combinazioni di conteggi compatibili con i totali e si valuta la distribuzione esatta di $W$.



### Test esatto di Fisher-Irwin

Per tabelle $2 \times 2$ con totali fissi, è possibile calcolare esattamente la distribuzione del conteggio in una cella (ad esempio $O_{11}$) sotto $H_0$.

Si utilizza la **distribuzione ipergeometrica**:
$$
P(O_{11} = k) = \frac{\binom{c}{k} \binom{d}{a - k}}{\binom{n}{a}}
$$
dove $a$, $c$, $d$, $n$ sono i totali delle righe e colonne.

#### Calcolo del p-value:
- se la distribuzione è simmetrica: $p = 2 \cdot P(O_{11} \le k_{\text{oss}})$
- altrimenti: si sommano le probabilità di tutti gli esiti con probabilità inferiore o uguale a quella osservata



### Conclusione

Il test del Chi-quadro è uno strumento molto utile per confrontare distribuzioni, verificare indipendenza o adattamento a modelli teorici. Tuttavia, la sua applicabilità richiede attenzione alle frequenze attese, alla numerosità del campione e al tipo di ipotesi testata. In caso di dubbio, è sempre consigliabile affiancare al test anche un’analisi visiva dei dati.
